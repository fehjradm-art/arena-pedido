<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ARENA PEDIDOS PRO - Sistema de Pedidos</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ff6b35;
            --secondary: #f7931e;
            --accent: #00d4ff;
            --dark: #0a0a0f;
            --darker: #050508;
            --card: #12121a;
            --light: #ffffff;
            --gray: #1a1a24;
            --success: #00ff88;
            --danger: #ff2a6d;
            --warning: #ffc107;
            --info: #00d4ff;
            --neon-glow: 0 0 10px rgba(255, 107, 53, 0.3), 0 0 20px rgba(255, 107, 53, 0.1);
            --neon-blue: 0 0 10px rgba(0, 212, 255, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            font-size: 16px;
            overflow-x: hidden;
        }

        body {
            font-family: 'Rajdhani', 'Roboto', sans-serif;
            background: var(--darker);
            color: var(--light);
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* ANIMA√á√ïES SUAVES */
        @keyframes gentle-pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        @keyframes soft-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(255, 107, 53, 0.2); }
            50% { box-shadow: 0 0 15px rgba(255, 107, 53, 0.4); }
        }

        @keyframes slide-smooth {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }

        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes border-shimmer {
            0% { background-position: -200% center; }
            100% { background-position: 200% center; }
        }

        @keyframes gentle-float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }

        .scanlines {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, rgba(255,255,255,0), rgba(255,255,255,0) 50%, rgba(0,0,0,0.05) 50%, rgba(0,0,0,0.05));
            background-size: 100% 4px;
            z-index: 9999;
            pointer-events: none;
            opacity: 0.15;
        }

        #particles-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        /* LETREIRO ELEGANTE E SUAVE */
        .marquee-container {
            background: linear-gradient(90deg, transparent, rgba(255, 107, 53, 0.05), transparent);
            border-top: 1px solid rgba(255, 107, 53, 0.2);
            border-bottom: 1px solid rgba(255, 107, 53, 0.2);
            overflow: hidden;
            position: relative;
            padding: 0.6rem 0;
            margin-bottom: 1.5rem;
        }

        .marquee-container::before,
        .marquee-container::after {
            content: '';
            position: absolute;
            top: 0;
            width: 80px;
            height: 100%;
            z-index: 2;
            pointer-events: none;
        }

        .marquee-container::before {
            left: 0;
            background: linear-gradient(to right, var(--darker), transparent);
        }

        .marquee-container::after {
            right: 0;
            background: linear-gradient(to left, var(--darker), transparent);
        }

        .marquee-content {
            display: flex;
            animation: slide-smooth 30s linear infinite;
            white-space: nowrap;
        }

        .marquee-content:hover {
            animation-play-state: paused;
        }

        .marquee-item {
            display: inline-flex;
            align-items: center;
            padding: 0 2.5rem;
            font-family: 'Rajdhani', sans-serif;
            font-size: 0.9rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: rgba(255, 255, 255, 0.7);
            transition: all 0.3s ease;
        }

        .marquee-item:hover {
            color: var(--primary);
        }

        .marquee-item .icon {
            margin-right: 0.6rem;
            font-size: 1rem;
            opacity: 0.8;
        }

        .marquee-divider {
            color: rgba(255, 107, 53, 0.3);
            margin: 0 0.5rem;
        }

        header {
            background: rgba(10, 10, 15, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 107, 53, 0.3);
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.5);
        }

        .header-content {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .logo {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
            letter-spacing: 2px;
            position: relative;
        }

        .logo::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary), transparent);
            background-size: 200% 100%;
            animation: border-shimmer 3s infinite;
        }

        .btn {
            padding: 0.6rem 1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            font-size: 0.8rem;
            font-family: 'Orbitron', sans-serif;
            position: relative;
            overflow: hidden;
            white-space: nowrap;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.3);
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            color: var(--light);
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
            border: 1px solid rgba(255, 107, 53, 0.5);
        }

        .btn-secondary {
            background: transparent;
            border: 1px solid var(--accent);
            color: var(--accent);
        }

        .btn-secondary:hover {
            background: rgba(0, 212, 255, 0.1);
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.3);
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 1rem;
        }

        .section {
            display: none;
            animation: fade-in-up 0.5s ease;
            width: 100%;
        }

        .section.active {
            display: block;
        }

        .hero {
            text-align: center;
            padding: 2rem 1rem;
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.05) 0%, rgba(0, 212, 255, 0.03) 100%);
            border-radius: 15px;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 107, 53, 0.15);
        }

        .hero h1 {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            line-height: 1.2;
            background: linear-gradient(45deg, var(--light), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .hero p {
            font-size: 1rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .order-form-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1.5rem;
            align-items: start;
        }

        .order-form {
            background: var(--card);
            padding: 1.5rem;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            width: 100%;
            position: relative;
            transition: all 0.3s ease;
        }

        .order-form:hover {
            border-color: rgba(255, 107, 53, 0.2);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.4);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.3rem;
            color: var(--accent);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 1px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.8rem;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: var(--light);
            font-size: 1rem;
            font-family: 'Rajdhani', sans-serif;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(255, 107, 53, 0.2);
        }

        /* TMDB Search Styles */
        .tmdb-search-container {
            position: relative;
        }

        .tmdb-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--card);
            border: 1px solid rgba(255, 107, 53, 0.3);
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            animation: fade-in-up 0.2s ease;
        }

        .tmdb-results.active {
            display: block;
        }

        .tmdb-item {
            display: flex;
            align-items: center;
            padding: 0.8rem;
            cursor: pointer;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            transition: all 0.2s;
        }

        .tmdb-item:hover {
            background: rgba(255, 107, 53, 0.1);
        }

        .tmdb-item img {
            width: 45px;
            height: 68px;
            object-fit: cover;
            border-radius: 4px;
            margin-right: 1rem;
        }

        .tmdb-item-info h4 {
            font-family: 'Rajdhani', sans-serif;
            font-size: 0.95rem;
            margin-bottom: 0.2rem;
            color: var(--light);
        }

        .tmdb-item-info p {
            font-size: 0.8rem;
            color: rgba(255,255,255,0.5);
        }

        .priority-selector {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .priority-option {
            flex: 1;
            padding: 0.8rem 0.5rem;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.8rem;
        }

        .priority-option:hover,
        .priority-option.selected {
            border-color: var(--primary);
            background: rgba(255, 107, 53, 0.1);
        }

        .priority-option.urgent.selected {
            border-color: var(--danger);
            background: rgba(255, 42, 109, 0.1);
            animation: gentle-pulse 2s infinite;
        }

        .image-upload-container {
            border: 2px dashed rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            background: rgba(0, 0, 0, 0.1);
        }

        .image-upload-container:hover {
            border-color: rgba(255, 107, 53, 0.4);
            background: rgba(255, 107, 53, 0.02);
        }

        .image-upload-container.has-image {
            border-style: solid;
            border-color: var(--success);
            padding: 0;
        }

        .upload-preview {
            width: 100%;
            max-height: 250px;
            object-fit: cover;
            border-radius: 8px;
            display: none;
        }

        .image-upload-container.has-image .upload-preview {
            display: block;
        }

        .remove-image-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--danger);
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 1.2rem;
            display: none;
            z-index: 10;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .image-upload-container.has-image .remove-image-btn {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .preview-card {
            background: var(--card);
            padding: 1.5rem;
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            width: 100%;
            position: relative;
            transition: all 0.3s ease;
        }

        .preview-card:hover {
            border-color: rgba(0, 212, 255, 0.2);
        }

        .preview-card h3 {
            font-family: 'Orbitron', sans-serif;
            color: var(--accent);
            margin-bottom: 1rem;
            text-align: center;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .movie-poster-preview {
            width: 100%;
            height: 250px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            margin-bottom: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            overflow: hidden;
        }

        .movie-poster-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Status do Pedido do Cliente */
        .client-order-status {
            background: var(--card);
            padding: 1.5rem;
            border-radius: 15px;
            border: 1px solid rgba(0, 255, 136, 0.2);
            margin-top: 1.5rem;
            display: none;
            width: 100%;
            animation: fade-in-up 0.4s ease;
        }

        .client-order-status.active {
            display: block;
        }

        .status-timeline {
            display: flex;
            justify-content: space-between;
            margin: 1.5rem 0;
            position: relative;
        }

        .status-timeline::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 0;
            right: 0;
            height: 2px;
            background: rgba(255, 255, 255, 0.1);
            z-index: 0;
        }

        .timeline-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 1;
            flex: 1;
        }

        .timeline-dot {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .timeline-step.active .timeline-dot {
            background: var(--success);
            border-color: var(--success);
            box-shadow: 0 0 15px rgba(0, 255, 136, 0.4);
        }

        .timeline-step.current .timeline-dot {
            background: var(--primary);
            border-color: var(--primary);
            box-shadow: 0 0 15px rgba(255, 107, 53, 0.4);
            animation: gentle-pulse 2s infinite;
        }

        .timeline-label {
            margin-top: 0.4rem;
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.5);
            text-align: center;
            font-family: 'Rajdhani', sans-serif;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .timeline-step.active .timeline-label,
        .timeline-step.current .timeline-label {
            color: var(--light);
        }

        /* Chat do Cliente */
        .client-chat-container {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .client-chat-messages {
            max-height: 250px;
            overflow-y: auto;
            margin-bottom: 1rem;
            padding: 0.5rem;
        }

        .chat-message {
            margin-bottom: 0.8rem;
            animation: fade-in-up 0.3s;
        }

        .chat-message.admin {
            text-align: right;
        }

        .chat-message-content {
            display: inline-block;
            padding: 0.6rem 0.9rem;
            border-radius: 12px;
            max-width: 85%;
            word-wrap: break-word;
            font-size: 0.9rem;
        }

        .chat-message.user .chat-message-content {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-bottom-left-radius: 4px;
        }

        .chat-message.admin .chat-message-content {
            background: var(--accent);
            color: var(--dark);
            border-bottom-right-radius: 4px;
        }

        .chat-message-time {
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.4);
            margin-top: 0.2rem;
        }

        .chat-input-container {
            display: flex;
            gap: 0.5rem;
        }

        .chat-input {
            flex: 1;
            padding: 0.7rem 1rem;
            background: rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            color: var(--light);
            font-family: 'Rajdhani', sans-serif;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .chat-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Bot√£o de recuperar pedido */
        .recover-order-btn {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: var(--card);
            border: 1px solid var(--accent);
            color: var(--accent);
            padding: 0.8rem 1.2rem;
            border-radius: 25px;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.8rem;
            z-index: 99;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            animation: gentle-float 4s ease-in-out infinite;
            display: none;
            backdrop-filter: blur(10px);
        }

        .recover-order-btn.show {
            display: block;
        }

        .recover-order-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.2);
        }

        /* Admin Dashboard */
        .admin-header {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .admin-header h1 {
            font-family: 'Orbitron';
            color: var(--secondary);
            font-size: 1.5rem;
            font-weight: 700;
        }

        .admin-header p {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.9rem;
        }

        .admin-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            width: 100%;
        }

        .live-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: rgba(0, 255, 136, 0.1);
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            border: 1px solid rgba(0, 255, 136, 0.3);
            color: var(--success);
            font-family: 'Orbitron', sans-serif;
            font-size: 0.75rem;
        }

        .live-dot {
            width: 6px;
            height: 6px;
            background: var(--success);
            border-radius: 50%;
            animation: gentle-pulse 2s infinite;
        }

        .stats-dashboard {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.8rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: var(--card);
            padding: 1.2rem;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            position: relative;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            border-color: rgba(255, 107, 53, 0.2);
            transform: translateY(-3px);
        }

        .stat-card h3 {
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.7rem;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
        }

        .stat-number {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        .orders-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .order-card {
            background: var(--card);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            overflow: hidden;
            transition: all 0.3s ease;
            width: 100%;
        }

        .order-card:hover {
            transform: translateY(-3px);
            border-color: rgba(255, 107, 53, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .order-card-header {
            padding: 1rem;
            background: rgba(255, 107, 53, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: start;
        }

        .order-id {
            font-family: 'Orbitron', sans-serif;
            color: var(--accent);
            font-size: 0.8rem;
        }

        .order-card-body {
            padding: 1rem;
        }

        .order-movie-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.3rem;
            line-height: 1.3;
            font-family: 'Rajdhani', sans-serif;
        }

        .order-customer {
            color: var(--secondary);
            margin-bottom: 0.8rem;
            font-size: 0.9rem;
        }

        .order-image-container {
            width: 100%;
            height: 180px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 0.8rem;
            cursor: pointer;
        }

        .order-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .order-image-container:hover img {
            transform: scale(1.05);
        }

        .order-meta {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            flex-wrap: wrap;
        }

        .order-observations {
            background: rgba(0, 0, 0, 0.2);
            padding: 0.8rem;
            border-radius: 8px;
            margin-bottom: 0.8rem;
            font-size: 0.85rem;
            border-left: 2px solid var(--primary);
            max-height: 80px;
            overflow-y: auto;
        }

        .order-card-footer {
            padding: 0.8rem 1rem;
            background: rgba(0, 0, 0, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .status-badge {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 0.5px;
        }

        .status-pending {
            background: rgba(255, 193, 7, 0.15);
            color: var(--warning);
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .status-completed {
            background: rgba(0, 255, 136, 0.15);
            color: var(--success);
            border: 1px solid rgba(0, 255, 136, 0.3);
        }

        .status-cancelled {
            background: rgba(255, 42, 109, 0.15);
            color: var(--danger);
            border: 1px solid rgba(255, 42, 109, 0.3);
        }

        .order-actions {
            display: flex;
            gap: 0.4rem;
        }

        .btn-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 1rem;
        }

        .btn-icon:hover {
            transform: scale(1.1);
        }

        .btn-complete { background: var(--success); color: var(--dark); }
        .btn-cancel { background: var(--danger); color: var(--light); }
        .btn-chat { 
            background: var(--accent); 
            color: var(--dark); 
            position: relative;
        }
        .btn-chat.has-new::after {
            content: '';
            position: absolute;
            top: -2px;
            right: -2px;
            width: 8px;
            height: 8px;
            background: var(--danger);
            border-radius: 50%;
            animation: gentle-pulse 1.5s infinite;
        }

        .filters-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .filters {
            display: flex;
            gap: 0.4rem;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 0.5rem 1rem;
            background: var(--card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.7);
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Orbitron', sans-serif;
            font-size: 0.75rem;
        }

        .filter-btn:hover,
        .filter-btn.active {
            background: var(--primary);
            border-color: var(--primary);
            color: var(--light);
        }

        .search-container {
            position: relative;
            width: 100%;
        }

        .search-input {
            width: 100%;
            padding: 0.7rem 1rem 0.7rem 2.5rem;
            background: var(--card);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 25px;
            color: var(--light);
            font-family: 'Rajdhani', sans-serif;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: flex-end;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card);
            padding: 1.5rem;
            border-radius: 20px 20px 0 0;
            border: 1px solid rgba(255, 107, 53, 0.2);
            border-bottom: none;
            width: 100%;
            max-width: 100%;
            max-height: 90vh;
            box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.5);
            animation: fade-in-up 0.3s ease;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-header h2 {
            font-family: 'Orbitron', sans-serif;
            color: var(--secondary);
            font-size: 1.2rem;
        }

        .chat-modal .modal-content {
            height: 85vh;
            max-height: 85vh;
        }

        .chat-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            min-height: 0;
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 12px;
            margin-bottom: 1rem;
            min-height: 0;
        }

        .image-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .image-modal.active {
            display: flex;
        }

        .image-modal img {
            max-width: 100%;
            max-height: 80vh;
            object-fit: contain;
            border-radius: 8px;
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.5);
        }

        .image-modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: var(--danger);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.2s;
        }

        .image-modal-close:hover {
            transform: rotate(90deg);
        }

        /* Notifications */
        .notification-container {
            position: fixed;
            top: 80px;
            right: 10px;
            left: 10px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .notification {
            padding: 1rem;
            background: var(--card);
            border-left: 3px solid var(--success);
            border-radius: 8px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            animation: fade-in-up 0.3s ease;
            width: 100%;
        }

        .notification.error { border-left-color: var(--danger); }
        .notification.info { border-left-color: var(--accent); }

        .notification-title {
            font-weight: 700;
            margin-bottom: 0.2rem;
            font-family: 'Orbitron';
            font-size: 0.85rem;
        }

        .notification-message {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.7);
        }

        /* Loading */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--darker);
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s;
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 2px solid rgba(255, 107, 53, 0.2);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Desktop */
        @media (min-width: 768px) {
            .container {
                padding: 2rem;
            }

            .logo {
                font-size: 2rem;
            }

            .hero {
                padding: 3rem 2rem;
            }

            .hero h1 {
                font-size: 3rem;
            }

            .order-form-container {
                grid-template-columns: 1fr 1fr;
                gap: 2rem;
            }

            .movie-poster-preview {
                height: 350px;
            }

            .preview-card {
                position: sticky;
                top: 100px;
            }

            .admin-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }

            .stats-dashboard {
                grid-template-columns: repeat(4, 1fr);
                gap: 1rem;
            }

            .orders-grid {
                grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
                gap: 1.5rem;
            }

            .filters-container {
                flex-direction: row;
                justify-content: space-between;
                align-items: center;
            }

            .search-container {
                width: 300px;
            }

            .modal {
                align-items: center;
            }

            .modal-content {
                border-radius: 15px;
                border: 1px solid rgba(255, 107, 53, 0.2);
                max-width: 500px;
                max-height: 90vh;
            }

            .chat-modal .modal-content {
                max-width: 600px;
                height: 70vh;
                border-radius: 15px;
            }

            .notification-container {
                top: 100px;
                right: 20px;
                left: auto;
                width: 350px;
            }

            .marquee-item {
                font-size: 0.85rem;
                padding: 0 3rem;
            }
        }

        * {
            scroll-behavior: smooth;
        }

        .chat-messages::-webkit-scrollbar,
        .client-chat-messages::-webkit-scrollbar {
            width: 4px;
        }

        .chat-messages::-webkit-scrollbar-thumb,
        .client-chat-messages::-webkit-scrollbar-thumb {
            background: rgba(255, 107, 53, 0.5);
            border-radius: 2px;
        }
    </style>
</head>
<body>
    <div class="scanlines"></div>
    <canvas id="particles-canvas"></canvas>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="loader"></div>
        <div style="margin-top: 1.5rem; font-family: 'Orbitron'; color: var(--primary); font-size: 0.9rem; opacity: 0.8;">Inicializando...</div>
    </div>

    <div class="notification-container" id="notificationContainer"></div>

    <button class="recover-order-btn" id="recoverOrderBtn" onclick="recoverMyOrder()">
        üì¶ Ver Meu Pedido
    </button>

    <audio id="notificationSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBTGH0fPTgjMGHm7A7+OZURE" type="audio/wav">
    </audio>

    <!-- LETREIRO ELEGANTE E SUAVE -->
    <div class="marquee-container">
        <div class="marquee-content">
            <div class="marquee-item"><span class="icon">üé¨</span> Arena Pedidos Pro <span class="marquee-divider">|</span></div>
            <div class="marquee-item"><span class="icon">‚ö°</span> Sistema em Tempo Real <span class="marquee-divider">|</span></div>
            <div class="marquee-item"><span class="icon">üé¨</span> Arena Pedidos Pro <span class="marquee-divider">|</span></div>
            <div class="marquee-item"><span class="icon">‚ö°</span> Sistema em Tempo Real <span class="marquee-divider">|</span></div>
            <div class="marquee-item"><span class="icon">üé¨</span> Arena Pedidos Pro <span class="marquee-divider">|</span></div>
            <div class="marquee-item"><span class="icon">‚ö°</span> Sistema em Tempo Real <span class="marquee-divider">|</span></div>
        </div>
    </div>

    <header>
        <div class="header-content">
            <div class="logo">ARENA <span style="color: rgba(255,255,255,0.9);">PEDIDOS</span></div>
            
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <div class="live-indicator" id="connectionStatus">
                    <div class="live-dot"></div>
                    <span>ONLINE</span>
                </div>
                
                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="showSection('home')">Novo Pedido</button>
                    <button class="btn btn-primary" onclick="showSection('admin')">Admin</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üîê Acesso Restrito</h2>
                <p>Digite a senha para continuar</p>
            </div>
            <div class="form-group">
                <label>Senha</label>
                <input type="password" id="adminPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeypress="if(event.key==='Enter')login()">
            </div>
            <button class="btn btn-primary" style="width: 100%; margin-top: 1rem;" onclick="login()">Entrar</button>
            <button class="btn btn-secondary" style="width: 100%; margin-top: 0.5rem;" onclick="closeLogin()">Voltar</button>
        </div>
    </div>

    <!-- Chat Modal -->
    <div class="modal chat-modal" id="chatModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üí¨ Chat</h2>
                <p id="chatOrderInfo">Pedido #000000</p>
            </div>
            <div class="chat-container">
                <div class="chat-messages" id="chatMessages"></div>
                <div class="chat-input-container">
                    <input type="text" class="chat-input" id="chatInput" placeholder="Digite sua mensagem..." onkeypress="if(event.key==='Enter')sendAdminMessage()">
                    <button class="btn btn-primary" onclick="sendAdminMessage()" style="padding: 0.7rem 1.2rem;">‚û§</button>
                </div>
            </div>
            <button class="btn btn-secondary" style="width: 100%; margin-top: 0.5rem;" onclick="closeChat()">Fechar Chat</button>
        </div>
    </div>

    <!-- Image Modal -->
    <div class="image-modal" id="imageModal">
        <button class="image-modal-close" onclick="closeImageModal()">√ó</button>
        <img id="modalImage" src="" alt="Preview">
    </div>

    <div class="container">
        <!-- Home Section -->
        <section id="home" class="section active">
            <div class="hero">
                <h1>SISTEMA DE PEDIDOS</h1>
                <p>Fa√ßa seu pedido e acompanhe em tempo real</p>
            </div>

            <div class="order-form-container">
                <div class="order-form">
                    <h2 style="margin-bottom: 1.5rem; color: var(--secondary); font-family: 'Orbitron'; text-align: center; font-size: 1.2rem;">
                        üìù Novo Pedido
                    </h2>
                    <form id="orderForm" onsubmit="submitOrder(event)">
                        <div class="form-group">
                            <label>Seu Nome *</label>
                            <input type="text" id="customerName" required placeholder="Como devemos te chamar?" oninput="updatePreview()">
                        </div>
                        
                        <div class="form-group tmdb-search-container">
                            <label>Filme/S√©rie * (Busca Inteligente TMDB)</label>
                            <input type="text" id="movieName" required placeholder="Digite para buscar..." oninput="searchTMDB(this.value)" autocomplete="off">
                            <div class="tmdb-results" id="tmdbResults"></div>
                            <small style="color: rgba(255,255,255,0.4); font-size: 0.75rem; margin-top: 0.3rem; display: block;">Dica: Digite o nome e selecione da lista</small>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.8rem;">
                            <div class="form-group">
                                <label>Ano</label>
                                <input type="number" id="movieYear" placeholder="2024" min="1900" max="2030" oninput="updatePreview()">
                            </div>
                            <div class="form-group">
                                <label>G√™nero</label>
                                <select id="movieGenre" onchange="updatePreview()">
                                    <option value="">Selecione</option>
                                    <option value="A√ß√£o">A√ß√£o</option>
                                    <option value="Anima√ß√£o">Anima√ß√£o</option>
                                    <option value="Aventura">Aventura</option>
                                    <option value="Com√©dia">Com√©dia</option>
                                    <option value="Document√°rio">Document√°rio</option>
                                    <option value="Drama">Drama</option>
                                    <option value="Fic√ß√£o Cient√≠fica">Fic√ß√£o Cient√≠fica</option>
                                    <option value="Horror">Horror</option>
                                    <option value="Romance">Romance</option>
                                    <option value="Suspense">Suspense</option>
                                    <option value="S√©rie">S√©rie</option>
                                    <option value="Outro">Outro</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Prioridade</label>
                            <div class="priority-selector">
                                <div class="priority-option selected" onclick="selectPriority('normal')" id="priority-normal">
                                    <div>üê¢</div>
                                    <small>Normal</small>
                                </div>
                                <div class="priority-option" onclick="selectPriority('alta')" id="priority-alta">
                                    <div>‚ö°</div>
                                    <small>Alta</small>
                                </div>
                                <div class="priority-option urgent" onclick="selectPriority('urgente')" id="priority-urgente">
                                    <div>üî•</div>
                                    <small>Urgente</small>
                                </div>
                            </div>
                            <input type="hidden" id="priority" value="normal">
                        </div>

                        <div class="form-group">
                            <label>Capa</label>
                            <div class="image-upload-container" id="imageUploadContainer" onclick="document.getElementById('movieImage').click()">
                                <input type="file" id="movieImage" class="image-upload-input" accept="image/*" onchange="handleImageSelect(event)">
                                <div class="upload-placeholder">
                                    <div style="font-size: 2rem; margin-bottom: 0.5rem; opacity: 0.4;">üñºÔ∏è</div>
                                    <p style="font-size: 0.9rem; color: rgba(255,255,255,0.6);">Clique para enviar</p>
                                    <small style="color: rgba(255,255,255,0.4); font-size: 0.75rem;">JPG, PNG (max 5MB)</small>
                                </div>
                                <img class="upload-preview" id="imagePreview" alt="Preview">
                                <button type="button" class="remove-image-btn" onclick="removeImage(event)">√ó</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Observa√ß√µes</label>
                            <textarea id="observations" rows="3" placeholder="Dublado? Legendado? Qualidade?" oninput="updatePreview()"></textarea>
                        </div>

                        <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1rem; font-size: 1rem;" id="submitBtn">
                            üöÄ Enviar Pedido
                        </button>
                    </form>
                </div>

                <div>
                    <div class="preview-card">
                        <h3>üëÅÔ∏è Preview</h3>
                        <div class="movie-poster-preview" id="previewPoster">
                            <span id="previewEmoji" style="opacity: 0.3; font-size: 4rem;">üé¨</span>
                            <img id="previewImage" style="display: none;">
                        </div>
                        <div class="preview-info">
                            <h4 id="previewTitle" style="font-size: 1.1rem; margin-bottom: 0.5rem; color: rgba(255,255,255,0.9);">Aguardando...</h4>
                            <div style="margin-bottom: 0.5rem;">
                                <span class="status-badge" style="display: none; margin-right: 0.3rem; font-size: 0.7rem; background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.7);" id="previewYearTag">2024</span>
                                <span class="status-badge" style="display: none; margin-right: 0.3rem; font-size: 0.7rem; background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.7);" id="previewGenreTag">A√ß√£o</span>
                                <span class="status-badge status-cancelled" style="display: none; font-size: 0.7rem;" id="previewPriorityTag">URGENTE</span>
                            </div>
                            <p style="color: rgba(255,255,255,0.5); margin-bottom: 0.3rem; font-size: 0.9rem;">
                                <strong style="color: rgba(255,255,255,0.7);">De:</strong> <span id="previewCustomer">-</span>
                            </p>
                            <p style="color: rgba(255,255,255,0.4); font-size: 0.85rem; line-height: 1.4;" id="previewObs">
                                Preencha o formul√°rio...
                            </p>
                        </div>
                    </div>

                    <!-- Status do Pedido -->
                    <div class="client-order-status" id="clientOrderStatus">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h3 style="font-family: 'Orbitron'; color: var(--success); font-size: 1rem;">
                                üì¶ Meu Pedido
                            </h3>
                            <button class="btn btn-warning" onclick="clearMyOrder()" style="padding: 0.3rem 0.8rem; font-size: 0.7rem;">üóë Limpar</button>
                        </div>
                        
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <div style="flex: 1; min-width: 0;">
                                <div style="font-size: 1rem; font-weight: 600; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; color: rgba(255,255,255,0.9);" id="clientMovieTitle">-</div>
                                <div style="color: rgba(255,255,255,0.4); font-size: 0.75rem;" id="clientOrderId">#000000</div>
                            </div>
                            <span class="status-badge" id="clientStatusBadge" style="margin-left: 0.5rem;">Pendente</span>
                        </div>

                        <div class="status-timeline" id="statusTimeline">
                            <div class="timeline-step current" id="step-1">
                                <div class="timeline-dot">üìù</div>
                                <div class="timeline-label">Recebido</div>
                            </div>
                            <div class="timeline-step" id="step-2">
                                <div class="timeline-dot">üëÅÔ∏è</div>
                                <div class="timeline-label">An√°lise</div>
                            </div>
                            <div class="timeline-step" id="step-3">
                                <div class="timeline-dot">‚öôÔ∏è</div>
                                <div class="timeline-label">Processo</div>
                            </div>
                            <div class="timeline-step" id="step-4">
                                <div class="timeline-dot">‚úÖ</div>
                                <div class="timeline-label">Pronto</div>
                            </div>
                        </div>

                        <!-- Chat -->
                        <div class="client-chat-container">
                            <h4 style="margin-bottom: 0.8rem; color: var(--accent); font-size: 0.85rem;">üí¨ Chat com Admin</h4>
                            <div class="client-chat-messages" id="clientChatMessages">
                                <div style="text-align: center; color: rgba(255,255,255,0.4); padding: 1rem; font-size: 0.85rem;">
                                    Nenhuma mensagem ainda...
                                </div>
                            </div>
                            <div class="chat-input-container">
                                <input type="text" class="chat-input" id="clientChatInput" placeholder="Digite..." onkeypress="if(event.key==='Enter')sendClientMessage()">
                                <button class="btn btn-primary" onclick="sendClientMessage()" style="padding: 0.7rem;">‚û§</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Admin Section -->
        <section id="admin" class="section">
            <div class="admin-header">
                <div>
                    <h1>üìä Painel Administrativo</h1>
                    <p style="color: rgba(255,255,255,0.5); font-size: 0.9rem;">Gerenciamento em tempo real</p>
                </div>
                <div class="admin-actions">
                    <div class="live-indicator" style="margin-right: auto;">
                        <div class="live-dot"></div>
                        <span>AO VIVO</span>
                    </div>
                    <button class="btn btn-secondary" onclick="exportData()">üì• Exportar</button>
                    <button class="btn btn-secondary" onclick="logout()">Sair</button>
                </div>
            </div>

            <div class="stats-dashboard">
                <div class="stat-card">
                    <h3>üì• Total</h3>
                    <div class="stat-number" id="statTotal">0</div>
                </div>
                <div class="stat-card">
                    <h3>‚è≥ Pendentes</h3>
                    <div class="stat-number" id="statPending" style="color: var(--warning);">0</div>
                </div>
                <div class="stat-card">
                    <h3>‚úÖ Conclu√≠dos</h3>
                    <div class="stat-number" id="statCompleted" style="color: var(--success);">0</div>
                </div>
                <div class="stat-card">
                    <h3>‚ö° Taxa</h3>
                    <div class="stat-number" id="statRate">0%</div>
                </div>
            </div>

            <div class="filters-container">
                <div class="filters">
                    <button class="filter-btn active" onclick="filterOrders('all')">Todos</button>
                    <button class="filter-btn" onclick="filterOrders('pending')">Pendentes</button>
                    <button class="filter-btn" onclick="filterOrders('completed')">Conclu√≠dos</button>
                    <button class="filter-btn" onclick="filterOrders('cancelled')">Cancelados</button>
                    <button class="filter-btn" onclick="filterOrders('urgent')" style="border-color: rgba(255, 42, 109, 0.5); color: var(--danger);">üî• Urgentes</button>
                </div>
                <div class="search-container">
                    <input type="text" class="search-input" id="searchInput" placeholder="Buscar pedidos..." oninput="searchOrders()">
                </div>
            </div>

            <div class="orders-grid" id="ordersGrid">
                <div style="text-align: center; padding: 3rem 1rem; color: rgba(255,255,255,0.4); grid-column: 1 / -1;">
                    <div style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;">üì≠</div>
                    <h3 style="font-size: 1.1rem; font-weight: 400;">Aguardando pedidos...</h3>
                </div>
            </div>
        </section>
    </div>

    <script>
        // ===== CONFIGURA√á√ÉO FIREBASE =====
        const firebaseConfig = {
            apiKey: "AIzaSyAppo_nh_032I5etNVjZ7IeS8JXwf6POw",
            authDomain: "pedidos-arena.firebaseapp.com",
            databaseURL: "https://pedidos-arena-default-rtdb.firebaseio.com",
            projectId: "pedidos-arena",
            storageBucket: "pedidos-arena.firebasestorage.app",
            messagingSenderId: "55419091930",
            appId: "1:55419091930:web:66d5c2ecb566d5f260dee3"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const ordersRef = db.ref('arena-pedidos-v2');
        const chatsRef = db.ref('arena-chats-v2');

        const ADMIN_PASSWORD = 'arena2024';
        let isAuthenticated = false;
        let currentFilter = 'all';
        let localOrders = [];
        let selectedImageBase64 = null;
        let currentChatOrderId = null;
        let myOrderId = null;
        let chatListeners = {};

        // ===== CONFIGURA√á√ÉO TMDB =====
        const TMDB_API_KEY = '75f121d37fe2d810eaa9b00f3839209e';
        const TMDB_BASE_URL = 'https://api.themoviedb.org/3';
        const TMDB_IMAGE_BASE = 'https://image.tmdb.org/t/p/w200';
        let tmdbSearchTimeout = null;

        async function searchTMDB(query) {
            const resultsContainer = document.getElementById('tmdbResults');
            
            if (!query || query.length < 3) {
                resultsContainer.classList.remove('active');
                return;
            }

            clearTimeout(tmdbSearchTimeout);
            tmdbSearchTimeout = setTimeout(async () => {
                try {
                    const [moviesRes, tvRes] = await Promise.all([
                        fetch(`${TMDB_BASE_URL}/search/movie?api_key=${TMDB_API_KEY}&language=pt-BR&query=${encodeURIComponent(query)}&page=1&include_adult=false`),
                        fetch(`${TMDB_BASE_URL}/search/tv?api_key=${TMDB_API_KEY}&language=pt-BR&query=${encodeURIComponent(query)}&page=1&include_adult=false`)
                    ]);

                    const movies = await moviesRes.json();
                    const tv = await tvRes.json();

                    const combined = [
                        ...movies.results.map(m => ({ ...m, type: 'movie' })),
                        ...tv.results.map(t => ({ ...t, type: 'tv', title: t.name, release_date: t.first_air_date }))
                    ]
                    .filter(item => item.poster_path)
                    .sort((a, b) => b.popularity - a.popularity)
                    .slice(0, 5);

                    displayTMDBResults(combined);
                } catch (error) {
                    console.error('Erro TMDB:', error);
                }
            }, 500);
        }

        function displayTMDBResults(results) {
            const container = document.getElementById('tmdbResults');
            
            if (results.length === 0) {
                container.classList.remove('active');
                return;
            }

            container.innerHTML = results.map(item => `
                <div class="tmdb-item" onclick="selectTMDBItem(${JSON.stringify(item).replace(/"/g, '&quot;')})">
                    <img src="${TMDB_IMAGE_BASE}${item.poster_path}" alt="${item.title}" loading="lazy">
                    <div class="tmdb-item-info">
                        <h4>${item.title}</h4>
                        <p>
                            <span class="year">${item.release_date ? item.release_date.split('-')[0] : 'N/A'}</span> ‚Ä¢ 
                            ${item.type === 'movie' ? 'üé¨ Filme' : 'üì∫ S√©rie'} ‚Ä¢ 
                            ‚≠ê ${item.vote_average.toFixed(1)}
                        </p>
                    </div>
                </div>
            `).join('');

            container.classList.add('active');
        }

        function selectTMDBItem(item) {
            document.getElementById('movieName').value = item.title;
            document.getElementById('movieYear').value = item.release_date ? item.release_date.split('-')[0] : '';
            
            const genreMap = {
                28: 'A√ß√£o', 12: 'Aventura', 16: 'Anima√ß√£o', 35: 'Com√©dia',
                80: 'Suspense', 99: 'Document√°rio', 18: 'Drama', 10751: 'Drama',
                14: 'Fic√ß√£o Cient√≠fica', 27: 'Horror', 10749: 'Romance',
                878: 'Fic√ß√£o Cient√≠fica', 53: 'Suspense', 10765: 'Fic√ß√£o Cient√≠fica',
                10759: 'A√ß√£o', 10762: 'Anima√ß√£o', 10763: 'Document√°rio',
                10764: 'S√©rie', 10766: 'S√©rie', 10767: 'Document√°rio'
            };

            if (item.genre_ids && item.genre_ids.length > 0) {
                const genre = genreMap[item.genre_ids[0]] || 'Outro';
                document.getElementById('movieGenre').value = genre;
            }

            if (item.poster_path) {
                const imageUrl = `https://image.tmdb.org/t/p/w500${item.poster_path}`;
                fetch(imageUrl)
                    .then(res => res.blob())
                    .then(blob => {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            selectedImageBase64 = e.target.result;
                            document.getElementById('imagePreview').src = e.target.result;
                            document.getElementById('imageUploadContainer').classList.add('has-image');
                            document.getElementById('previewImage').src = e.target.result;
                            document.getElementById('previewImage').style.display = 'block';
                            document.getElementById('previewEmoji').style.display = 'none';
                            updatePreview();
                        };
                        reader.readAsDataURL(blob);
                    });
            }

            document.getElementById('tmdbResults').classList.remove('active');
            updatePreview();
            showNotification('TMDB', 'Informa√ß√µes preenchidas!', 'success');
        }

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.tmdb-search-container')) {
                document.getElementById('tmdbResults').classList.remove('active');
            }
        });

        // ===== INICIALIZA√á√ÉO =====
        document.addEventListener('DOMContentLoaded', () => {
            initParticles();
            initFirebase();
            checkSavedOrder();
            setTimeout(() => {
                document.getElementById('loadingOverlay').classList.add('hidden');
            }, 800);
        });

        function initFirebase() {
            ordersRef.on('value', (snapshot) => {
                const data = snapshot.val();
                localOrders = data ? Object.entries(data).map(([key, value]) => ({...value, id: key})) : [];
                
                updateStats();
                if (document.getElementById('admin').classList.contains('active')) {
                    renderOrders();
                }
            });

            ordersRef.limitToLast(1).on('child_added', (snapshot) => {
                const order = snapshot.val();
                if (order.timestamp > Date.now() - 5000) {
                    showNotification('Novo Pedido!', `${order.movie} - ${order.customer}`, 'info');
                    playSound();
                }
            });
        }

        // ===== VERIFICAR PEDIDO SALVO =====
        function checkSavedOrder() {
            const savedOrderId = localStorage.getItem('myOrderId');
            const savedOrderData = localStorage.getItem('myOrderData');
            
            if (savedOrderId && savedOrderData) {
                try {
                    const orderData = JSON.parse(savedOrderData);
                    myOrderId = savedOrderId;
                    
                    document.getElementById('recoverOrderBtn').classList.add('show');
                    
                    restoreClientOrder(orderData, myOrderId);
                    
                    initClientChat(myOrderId);
                    
                    showNotification('Pedido Recuperado', 'Seu pedido anterior foi carregado!', 'success');
                } catch (e) {
                    console.error('Erro ao recuperar pedido:', e);
                    clearOrderStorage();
                }
            }
        }

        function restoreClientOrder(order, orderId) {
            const statusDiv = document.getElementById('clientOrderStatus');
            statusDiv.classList.add('active');
            
            document.getElementById('clientMovieTitle').textContent = order.movie;
            document.getElementById('clientOrderId').textContent = `#${orderId.substr(-6).toUpperCase()}`;
            updateClientStatusUI(order.status || 'pending');
            
            setTimeout(() => {
                statusDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 500);
        }

        function recoverMyOrder() {
            if (myOrderId) {
                const statusDiv = document.getElementById('clientOrderStatus');
                statusDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                ordersRef.child(myOrderId).once('value', (snapshot) => {
                    const order = snapshot.val();
                    if (order) {
                        updateClientStatusUI(order.status);
                        document.getElementById('clientMovieTitle').textContent = order.movie;
                    }
                });
            }
        }

        function clearMyOrder() {
            if (!confirm('Deseja remover o acompanhamento deste pedido? O pedido continuar√° no sistema.')) return;
            
            clearOrderStorage();
            
            document.getElementById('clientOrderStatus').classList.remove('active');
            document.getElementById('recoverOrderBtn').classList.remove('show');
            
            document.getElementById('clientChatMessages').innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.4); padding: 1rem; font-size: 0.85rem;">Nenhuma mensagem ainda...</div>';
            
            if (chatListeners.client) {
                chatsRef.child(chatListeners.client).off();
                ordersRef.child(chatListeners.client).off();
                delete chatListeners.client;
            }
            
            myOrderId = null;
            
            showNotification('Limpo', 'Acompanhamento removido', 'info');
        }

        function clearOrderStorage() {
            localStorage.removeItem('myOrderId');
            localStorage.removeItem('myOrderData');
        }

        function saveOrderToStorage(orderId, orderData) {
            localStorage.setItem('myOrderId', orderId);
            localStorage.setItem('myOrderData', JSON.stringify(orderData));
        }

        // ===== PART√çCULAS =====
        function initParticles() {
            const canvas = document.getElementById('particles-canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            const particles = [];
            const count = window.innerWidth < 768 ? 20 : 40;

            for (let i = 0; i < count; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    vx: (Math.random() - 0.5) * 0.3,
                    vy: (Math.random() - 0.5) * 0.3,
                    size: Math.random() * 1.5,
                    color: Math.random() > 0.5 ? 'rgba(255, 107, 53, 0.3)' : 'rgba(0, 212, 255, 0.3)'
                });
            }

            function animate() {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                particles.forEach(p => {
                    p.x += p.vx;
                    p.y += p.vy;
                    if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                    if (p.y < 0 || p.y > canvas.height) p.vy *= -1;

                    ctx.fillStyle = p.color;
                    ctx.beginPath();
                    ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                    ctx.fill();
                });

                requestAnimationFrame(animate);
            }
            animate();

            window.addEventListener('resize', () => {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
            });
        }

        // ===== LOGIN =====
        function login() {
            const pass = document.getElementById('adminPassword').value;
            if (pass === ADMIN_PASSWORD) {
                isAuthenticated = true;
                document.getElementById('loginModal').classList.remove('active');
                document.getElementById('adminPassword').value = '';
                showSection('admin');
                showNotification('Bem-vindo!', 'Acesso concedido', 'success');
            } else {
                showNotification('Erro', 'Senha incorreta!', 'error');
            }
        }

        function closeLogin() {
            document.getElementById('loginModal').classList.remove('active');
        }

        function logout() {
            isAuthenticated = false;
            showSection('home');
            showNotification('Logout', 'Voc√™ saiu', 'info');
        }

        // ===== FORMUL√ÅRIO =====
        function handleImageSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (file.size > 5 * 1024 * 1024) {
                showNotification('Erro', 'Imagem muito grande! Max 5MB.', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                selectedImageBase64 = e.target.result;
                document.getElementById('imagePreview').src = e.target.result;
                document.getElementById('imageUploadContainer').classList.add('has-image');
                document.getElementById('previewImage').src = e.target.result;
                document.getElementById('previewImage').style.display = 'block';
                document.getElementById('previewEmoji').style.display = 'none';
            };
            reader.readAsDataURL(file);
        }

        function removeImage(event) {
            event.stopPropagation();
            selectedImageBase64 = null;
            document.getElementById('movieImage').value = '';
            document.getElementById('imagePreview').src = '';
            document.getElementById('imageUploadContainer').classList.remove('has-image');
            document.getElementById('previewImage').style.display = 'none';
            document.getElementById('previewEmoji').style.display = 'block';
        }

        function selectPriority(level) {
            document.querySelectorAll('.priority-option').forEach(el => el.classList.remove('selected'));
            document.getElementById(`priority-${level}`).classList.add('selected');
            document.getElementById('priority').value = level;
            updatePreview();
        }

        function updatePreview() {
            const name = document.getElementById('customerName').value || 'Cliente';
            const movie = document.getElementById('movieName').value || 'Aguardando...';
            const year = document.getElementById('movieYear').value;
            const genre = document.getElementById('movieGenre').value;
            const obs = document.getElementById('observations').value;
            const priority = document.getElementById('priority').value;

            document.getElementById('previewTitle').textContent = movie;
            document.getElementById('previewCustomer').textContent = name;
            document.getElementById('previewObs').textContent = obs || 'Nenhuma observa√ß√£o...';

            document.getElementById('previewYearTag').style.display = year ? 'inline-block' : 'none';
            document.getElementById('previewYearTag').textContent = year;
            
            document.getElementById('previewGenreTag').style.display = genre ? 'inline-block' : 'none';
            document.getElementById('previewGenreTag').textContent = genre;

            document.getElementById('previewPriorityTag').style.display = priority === 'urgente' ? 'inline-block' : 'none';
        }

        // ===== ENVIO =====
        function submitOrder(e) {
            e.preventDefault();
            
            const btn = document.getElementById('submitBtn');
            btn.innerHTML = '‚è≥ Enviando...';
            btn.disabled = true;

            const orderData = {
                timestamp: Date.now(),
                date: new Date().toLocaleString('pt-BR'),
                customer: document.getElementById('customerName').value,
                movie: document.getElementById('movieName').value,
                year: document.getElementById('movieYear').value || 'N/A',
                genre: document.getElementById('movieGenre').value || 'N√£o especificado',
                priority: document.getElementById('priority').value,
                observations: document.getElementById('observations').value || 'Nenhuma',
                imageUrl: selectedImageBase64,
                status: 'pending',
                hasNewMessage: false
            };

            const newOrderRef = ordersRef.push();
            newOrderRef.set(orderData)
                .then(() => {
                    myOrderId = newOrderRef.key;
                    
                    saveOrderToStorage(myOrderId, orderData);
                    
                    document.getElementById('recoverOrderBtn').classList.add('show');
                    
                    showClientOrderStatus(orderData, myOrderId);
                    initClientChat(myOrderId);
                    
                    btn.innerHTML = '‚úÖ Enviado!';
                    setTimeout(() => {
                        btn.innerHTML = 'üöÄ Enviar Pedido';
                        btn.disabled = false;
                        document.getElementById('orderForm').reset();
                        removeImage({ stopPropagation: () => {} });
                        selectPriority('normal');
                        updatePreview();
                    }, 2000);

                    showNotification('Sucesso!', 'Pedido enviado!', 'success');
                })
                .catch((error) => {
                    btn.innerHTML = '‚ùå Tentar Novamente';
                    btn.disabled = false;
                    showNotification('Erro', 'Falha ao enviar', 'error');
                });
        }

        // ===== STATUS CLIENTE =====
        function showClientOrderStatus(order, orderId) {
            const statusDiv = document.getElementById('clientOrderStatus');
            statusDiv.classList.add('active');
            
            document.getElementById('clientMovieTitle').textContent = order.movie;
            document.getElementById('clientOrderId').textContent = `#${orderId.substr(-6).toUpperCase()}`;
            updateClientStatusUI(order.status);
            
            setTimeout(() => {
                statusDiv.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }, 100);
        }

        function updateClientStatusUI(status) {
            const badge = document.getElementById('clientStatusBadge');
            const steps = { pending: 1, analysing: 2, processing: 3, completed: 4, cancelled: 0 };
            const step = steps[status] || 1;
            
            for (let i = 1; i <= 4; i++) {
                const stepEl = document.getElementById(`step-${i}`);
                stepEl.classList.remove('active', 'current');
                if (i < step) stepEl.classList.add('active');
                if (i === step) stepEl.classList.add('current');
            }
            
            badge.className = 'status-badge';
            if (status === 'pending') {
                badge.classList.add('status-pending');
                badge.textContent = 'Pendente';
            } else if (status === 'completed') {
                badge.classList.add('status-completed');
                badge.textContent = 'Conclu√≠do';
            } else if (status === 'cancelled') {
                badge.classList.add('status-cancelled');
                badge.textContent = 'Cancelado';
            }
        }

        // ===== CHAT CLIENTE =====
        function initClientChat(orderId) {
            if (chatListeners.client) {
                chatsRef.child(chatListeners.client).off();
                ordersRef.child(chatListeners.client).off();
            }
            
            chatListeners.client = orderId;
            
            chatsRef.child(orderId).on('value', (snapshot) => {
                const messages = snapshot.val();
                renderClientChat(messages);
            });
            
            ordersRef.child(orderId).on('value', (snapshot) => {
                const order = snapshot.val();
                if (order) {
                    updateClientStatusUI(order.status);
                    
                    const savedData = localStorage.getItem('myOrderData');
                    if (savedData) {
                        const parsed = JSON.parse(savedData);
                        parsed.status = order.status;
                        localStorage.setItem('myOrderData', JSON.stringify(parsed));
                    }
                    
                    if (order.hasNewMessage && order.lastMessageSender === 'admin') {
                        showNotification('Nova Mensagem', 'Admin respondeu!', 'info');
                        playSound();
                        ordersRef.child(orderId).update({ hasNewMessage: false });
                    }
                }
            });
        }

        function renderClientChat(messages) {
            const container = document.getElementById('clientChatMessages');
            
            if (!messages || Object.keys(messages).length === 0) {
                container.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.4); padding: 1rem; font-size: 0.85rem;">Nenhuma mensagem ainda...</div>';
                return;
            }
            
            const messagesArray = Object.entries(messages).sort((a, b) => a[1].timestamp - b[1].timestamp);
            
            container.innerHTML = messagesArray.map(([key, msg]) => `
                <div class="chat-message ${msg.sender}">
                    <div class="chat-message-content">${escapeHtml(msg.text)}</div>
                    <div class="chat-message-time">${msg.time}</div>
                </div>
            `).join('');
            
            container.scrollTop = container.scrollHeight;
        }

        function sendClientMessage() {
            const input = document.getElementById('clientChatInput');
            const text = input.value.trim();
            
            if (!text || !myOrderId) return;
            
            const message = {
                text: text,
                sender: 'user',
                time: new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'}),
                timestamp: Date.now()
            };
            
            chatsRef.child(myOrderId).push(message);
            
            ordersRef.child(myOrderId).update({
                hasNewMessage: true,
                lastMessageSender: 'user',
                lastMessageTime: Date.now()
            });
            
            input.value = '';
        }

        // ===== ADMIN =====
        function showSection(section) {
            if (section === 'admin' && !isAuthenticated) {
                document.getElementById('loginModal').classList.add('active');
                return;
            }
            
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(section).classList.add('active');
            
            if (section === 'admin') {
                renderOrders();
            }
        }

        function updateStats() {
            const total = localOrders.length;
            const pending = localOrders.filter(o => o.status === 'pending').length;
            const completed = localOrders.filter(o => o.status === 'completed').length;
            const rate = total > 0 ? Math.round((completed / total) * 100) : 0;
            
            document.getElementById('statTotal').textContent = total;
            document.getElementById('statPending').textContent = pending;
            document.getElementById('statCompleted').textContent = completed;
            document.getElementById('statRate').textContent = rate + '%';
        }

        function filterOrders(status) {
            currentFilter = status;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderOrders();
        }

        function searchOrders() {
            renderOrders();
        }

        function renderOrders() {
            const grid = document.getElementById('ordersGrid');
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            
            let filtered = localOrders;
            
            if (currentFilter !== 'all') {
                if (currentFilter === 'urgent') {
                    filtered = localOrders.filter(o => o.priority === 'urgente');
                } else {
                    filtered = localOrders.filter(o => o.status === currentFilter);
                }
            }
            
            if (searchTerm) {
                filtered = filtered.filter(o => 
                    o.movie.toLowerCase().includes(searchTerm) || 
                    o.customer.toLowerCase().includes(searchTerm)
                );
            }
            
            filtered.sort((a, b) => b.timestamp - a.timestamp);
            
            if (filtered.length === 0) {
                grid.innerHTML = `
                    <div style="text-align: center; padding: 3rem 1rem; color: rgba(255,255,255,0.4); grid-column: 1 / -1;">
                        <div style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;">üì≠</div>
                        <h3 style="font-size: 1.1rem; font-weight: 400;">Nenhum pedido encontrado</h3>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = filtered.map(order => `
                <div class="order-card" id="order-${order.id}">
                    <div class="order-card-header">
                        <div>
                            <div class="order-id">#${order.id.substr(-6).toUpperCase()}</div>
                            <div style="font-size: 0.75rem; color: rgba(255,255,255,0.4);">${order.date}</div>
                        </div>
                        <div style="display: flex; gap: 0.3rem; align-items: center;">
                            ${order.priority === 'urgente' ? '<span style="font-size: 1rem;">üî•</span>' : ''}
                            ${order.hasNewMessage ? '<span style="background: var(--danger); color: white; padding: 0.15rem 0.4rem; border-radius: 8px; font-size: 0.65rem; font-weight: bold;">NOVO</span>' : ''}
                        </div>
                    </div>
                    
                    <div class="order-card-body">
                        <div class="order-image-container" onclick="openImageModal('${order.imageUrl || ''}')">
                            ${order.imageUrl ? 
                                `<img src="${order.imageUrl}" alt="Capa" loading="lazy">` : 
                                '<div style="height: 100%; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; opacity: 0.2;">üé¨</div>'
                            }
                        </div>
                        
                        <div class="order-movie-title">${escapeHtml(order.movie)}</div>
                        <div class="order-customer" style="color: rgba(255,255,255,0.6);">üë§ ${escapeHtml(order.customer)}</div>
                        
                        <div class="order-meta">
                            <span class="status-badge" style="font-size: 0.7rem; background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.7);">${order.year}</span>
                            <span class="status-badge" style="font-size: 0.7rem; background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.7);">${order.genre}</span>
                        </div>
                        
                        ${order.observations !== 'Nenhuma' ? `
                            <div class="order-observations">${escapeHtml(order.observations)}</div>
                        ` : ''}
                    </div>

                    <div class="order-card-footer">
                        <span class="status-badge status-${order.status}">${getStatusText(order.status)}</span>
                        <div class="order-actions">
                            <button class="btn-icon btn-chat ${order.hasNewMessage ? 'has-new' : ''}" onclick="openAdminChat('${order.id}')" title="Chat">üí¨</button>
                            ${order.status === 'pending' ? `
                                <button class="btn-icon btn-complete" onclick="updateStatus('${order.id}', 'completed')" title="Concluir">‚úì</button>
                                <button class="btn-icon btn-cancel" onclick="updateStatus('${order.id}', 'cancelled')" title="Cancelar">‚úï</button>
                            ` : ''}
                            <button class="btn-icon btn-delete" onclick="deleteOrder('${order.id}')" title="Excluir" style="background: rgba(255,255,255,0.1); color: var(--danger);">üóë</button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ===== CHAT ADMIN =====
        function openAdminChat(orderId) {
            currentChatOrderId = orderId;
            const order = localOrders.find(o => o.id === orderId);
            if (!order) return;
            
            document.getElementById('chatOrderInfo').textContent = `#${orderId.substr(-6).toUpperCase()} - ${order.movie}`;
            document.getElementById('chatModal').classList.add('active');
            
            document.getElementById('chatInput').value = '';
            document.getElementById('chatInput').focus();
            
            loadAdminChatMessages(orderId);
            
            if (chatListeners[orderId]) {
                chatsRef.child(orderId).off('value', chatListeners[orderId]);
            }
            
            const listener = chatsRef.child(orderId).on('value', (snapshot) => {
                const messages = snapshot.val();
                renderAdminChat(messages);
            });
            
            chatListeners[orderId] = listener;
            
            ordersRef.child(orderId).update({ hasNewMessage: false });
        }

        function loadAdminChatMessages(orderId) {
            chatsRef.child(orderId).once('value', (snapshot) => {
                const messages = snapshot.val();
                renderAdminChat(messages);
            });
        }

        function renderAdminChat(messages) {
            const container = document.getElementById('chatMessages');
            
            if (!messages || Object.keys(messages).length === 0) {
                container.innerHTML = '<div style="text-align: center; color: rgba(255,255,255,0.4); padding: 2rem;">Nenhuma mensagem. Inicie a conversa!</div>';
                return;
            }
            
            const messagesArray = Object.entries(messages).sort((a, b) => a[1].timestamp - b[1].timestamp);
            
            container.innerHTML = messagesArray.map(([key, msg]) => `
                <div class="chat-message ${msg.sender}">
                    <div class="chat-message-content">${escapeHtml(msg.text)}</div>
                    <div class="chat-message-time">${msg.time} ¬∑ ${msg.sender === 'admin' ? 'Voc√™' : 'Cliente'}</div>
                </div>
            `).join('');
            
            container.scrollTop = container.scrollHeight;
        }

        function sendAdminMessage() {
            const input = document.getElementById('chatInput');
            const text = input.value.trim();
            
            if (!text || !currentChatOrderId) return;
            
            const message = {
                text: text,
                sender: 'admin',
                time: new Date().toLocaleTimeString('pt-BR', {hour: '2-digit', minute:'2-digit'}),
                timestamp: Date.now()
            };
            
            chatsRef.child(currentChatOrderId).push(message)
                .then(() => {
                    return ordersRef.child(currentChatOrderId).update({
                        hasNewMessage: true,
                        lastMessageSender: 'admin',
                        lastMessageTime: Date.now()
                    });
                })
                .then(() => {
                    input.value = '';
                    input.focus();
                })
                .catch((error) => {
                    showNotification('Erro', 'N√£o foi poss√≠vel enviar mensagem', 'error');
                });
        }

        function closeChat() {
            document.getElementById('chatModal').classList.remove('active');
            
            if (currentChatOrderId && chatListeners[currentChatOrderId]) {
                chatsRef.child(currentChatOrderId).off('value', chatListeners[currentChatOrderId]);
                delete chatListeners[currentChatOrderId];
            }
            
            currentChatOrderId = null;
        }

        // ===== A√á√ïES =====
        function updateStatus(orderId, status) {
            ordersRef.child(orderId).update({ 
                status: status,
                statusUpdatedAt: Date.now()
            }).then(() => {
                showNotification('Atualizado', `Status: ${getStatusText(status)}`, 'success');
            }).catch((error) => {
                showNotification('Erro', 'Falha ao atualizar', 'error');
            });
        }

        function deleteOrder(orderId) {
            if (!confirm('Deseja realmente excluir este pedido?')) return;
            
            ordersRef.child(orderId).remove()
                .then(() => {
                    chatsRef.child(orderId).remove();
                    showNotification('Exclu√≠do', 'Pedido removido', 'warning');
                });
        }

        function exportData() {
            const dataStr = JSON.stringify(localOrders, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `pedidos-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            showNotification('Exportado!', 'Dados salvos', 'success');
        }

        function openImageModal(url) {
            if (!url) return;
            document.getElementById('modalImage').src = url;
            document.getElementById('imageModal').classList.add('active');
        }

        function closeImageModal() {
            document.getElementById('imageModal').classList.remove('active');
        }

        function getStatusText(status) {
            const map = { 
                pending: 'Pendente', 
                completed: 'Conclu√≠do', 
                cancelled: 'Cancelado'
            };
            return map[status] || status;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function playSound() {
            const audio = document.getElementById('notificationSound');
            audio.play().catch(e => {});
        }

        function showNotification(title, message, type = 'success') {
            const container = document.getElementById('notificationContainer');
            const notif = document.createElement('div');
            notif.className = `notification ${type}`;
            notif.innerHTML = `
                <div class="notification-title">${title}</div>
                <div class="notification-message">${message}</div>
            `;
            container.appendChild(notif);
            
            setTimeout(() => {
                notif.style.opacity = '0';
                notif.style.transform = 'translateX(100%)';
                setTimeout(() => notif.remove(), 300);
            }, 3000);
        }

        // Fechar modais
        window.onclick = function(event) {
            if (event.target === document.getElementById('loginModal')) {
                closeLogin();
            } else if (event.target === document.getElementById('chatModal')) {
                closeChat();
            } else if (event.target === document.getElementById('imageModal')) {
                closeImageModal();
            }
        }

        // Prevenir zoom em inputs no iOS
        document.addEventListener('gesturestart', function(e) {
            e.preventDefault();
        });
    </script>
</body>
</html>
